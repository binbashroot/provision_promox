{% set subscription = tags |regex_search('rhel[7-9]') %}
{% if subscription | trim == 'rhel7' %}
subscription-manager register --username {{ redhat_user }} --password {{ redhat_pass }}
{% elif subscription == 'rhel8' or subscription == 'rhel9' and satellite_params is defined %}
{% if subscription == 'rhel8' %}
update-alternatives --remove python /usr/libexec/no-python;
alternatives --set python /usr/bin/python3.9;
{% endif %}
curl -k https://{{ satellite_params['baseurl'] }}/pub/bootstrap.py | {% if subscription == 'rhel8' -%}
/usr/libexec/platform-python{% else %}/usr/bin/python{% endif %} - -l {{ satellite_params['username'] }} \
-p {{ satellite_params['password'] }} -s {{ satellite_params['baseurl'] }} \
-o {{ satellite_params['organization'] }} -L {{ satellite_params['location'] }} \
-a {{ subscription }}_activation_key_{{ lifecycle|default('prod') }} -g {{ subscription | upper }}_{{ lifecycle|default('PROD') }} --force;
{% else %}
subscription-manager register --username {{ redhat_user }} --password {{ redhat_pass }};
{% endif %}
truncate -s 0 /var/log/secure 
